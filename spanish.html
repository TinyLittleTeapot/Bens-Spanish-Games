<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Spanish Numbers</title>
  <style>
    body{margin:0;font-family:-apple-system,system-ui;background:#0b1220;color:#e8eefc;text-align:center;padding:16px;}
    h1{font-size:20px;margin:10px 0 4px;}
    #num{font-size:56px;font-weight:900;margin:18px 0 10px;}
    .hint{opacity:0.85;margin-bottom:12px;}
    .topRow{display:grid;gap:10px;margin-top:10px;}
    select{
      width:100%;padding:14px;border-radius:14px;border:1px solid rgba(255,255,255,0.2);
      background:#121c33;color:#e8eefc;font-size:16px;font-weight:800;
    }
    .pill{
      padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.06);font-weight:800;display:inline-block;
    }
    .topBtn{
      width:100%;padding:14px;font-size:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.2);
      background:rgba(255,255,255,0.06);color:#e8eefc;font-weight:800;
    }
    #choices{display:grid;gap:12px;margin-top:12px;}
    button.choice{
      width:100%;padding:16px;font-size:22px;border-radius:14px;border:1px solid rgba(255,255,255,0.2);
      background:#121c33;color:#e8eefc;font-weight:800;
    }
    button.choice.good{background:rgba(96,255,165,0.18);border-color:rgba(96,255,165,0.55);}
    button.choice.bad{background:rgba(255,96,96,0.18);border-color:rgba(255,96,96,0.55);}
    #status{margin-top:12px;min-height:22px;font-size:18px;font-weight:900;}
    .flag{position:fixed;right:12px;bottom:12px;font-size:26px;opacity:0.95;user-select:none;}
  </style>
</head>
<body>

<h1>Spanish Numbers</h1>
<div id="num">‚Äì</div>
<div class="hint">Tap the correct Spanish</div>

<div class="topRow">
  <button class="topBtn" onclick="showLevelSelect()">üîô Change level</button>

  <select id="level" onchange="startGame()">
    <option value="20">Level: 0 to 20</option>
    <option value="100">Level: 0 to 100</option>
    <option value="9999" selected>Level: 0 to 9999</option>
  </select>

  <button class="topBtn" onclick="sayAnswer()">üîä Hear the answer</button>

  <div class="pill">Aciertos: <span id="correctCount">0</span></div>
</div>

<div id="choices"></div>
<div id="status"></div>

<div class="flag">üá™üá∏</div>

<script>
/* Feedback */
const praise = ["¬°Muy bien!", "¬°Bravo!", "¬°Correcto!", "¬°Genial!"];
const tryAgain = "Int√©ntalo de nuevo";

/* State */
let current = 0;
let correctTotal = 0;
let maxRange = 9999;
let locked = false;

/* Voice */
let esVoice = null;

function loadSpanishVoice(){
  const voices = speechSynthesis.getVoices();
  esVoice =
    voices.find(v => (v.lang||"").toLowerCase().startsWith("es-es")) ||
    voices.find(v => (v.lang||"").toLowerCase().startsWith("es")) ||
    null;
}
speechSynthesis.onvoiceschanged = loadSpanishVoice;
loadSpanishVoice();

function speak(text){
  const u = new SpeechSynthesisUtterance(text);
  if(esVoice) u.voice = esVoice;
  u.lang = esVoice?.lang || "es-ES";
  u.rate = 0.95;
  u.pitch = 1.0;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}
function waitForSpeechEnd(text){
  return new Promise(resolve=>{
    const u = new SpeechSynthesisUtterance(text);
    if(esVoice) u.voice = esVoice;
    u.lang = esVoice?.lang || "es-ES";
    u.rate = 0.95;
    u.pitch = 1.0;
    u.onend = resolve;
    u.onerror = resolve;
    speechSynthesis.speak(u);
  });
}

/* Tiny sound effects */
let audioCtx = null;
function ctx(){
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}
function beep(freq, ms, type="sine", vol=0.08){
  const c = ctx();
  const o = c.createOscillator();
  const g = c.createGain();
  o.type = type;
  o.frequency.value = freq;
  g.gain.value = vol;
  o.connect(g); g.connect(c.destination);
  o.start();
  setTimeout(()=>{ o.stop(); }, ms);
}
function wrongBuzzer(){
  beep(180,120,"square",0.09);
  setTimeout(()=>beep(140,180,"square",0.09),130);
}
function rightChime(){
  beep(660,90,"sine",0.06);
  setTimeout(()=>beep(880,120,"sine",0.06),110);
  setTimeout(()=>beep(990,140,"sine",0.06),250);
}

/* Spanish number words (0‚Äì9999) */
const units = {
  0:"cero",1:"uno",2:"dos",3:"tres",4:"cuatro",5:"cinco",
  6:"seis",7:"siete",8:"ocho",9:"nueve"
};
const teens = {
  10:"diez",11:"once",12:"doce",13:"trece",14:"catorce",15:"quince",
  16:"diecis√©is",17:"diecisiete",18:"dieciocho",19:"diecinueve"
};
const tens = {
  20:"veinte",30:"treinta",40:"cuarenta",50:"cincuenta",
  60:"sesenta",70:"setenta",80:"ochenta",90:"noventa"
};
const hundreds = {
  1:"ciento",2:"doscientos",3:"trescientos",4:"cuatrocientos",
  5:"quinientos",6:"seiscientos",7:"setecientos",8:"ochocientos",9:"novecientos"
};

function under100(n){
  if(n < 10) return units[n];
  if(n < 20) return teens[n];
  if(n === 20) return "veinte";
  if(n < 30) return "veinti" + units[n % 10];
  if(n % 10 === 0) return tens[n];
  const t = Math.floor(n/10)*10;
  const r = n%10;
  return tens[t] + " y " + units[r];
}

function under1000(n){
  if(n < 100) return under100(n);
  if(n === 100) return "cien";
  const h = Math.floor(n/100);
  const r = n%100;
  const hWord = hundreds[h];
  if(r === 0) return hWord;
  return hWord + " " + under100(r);
}

function numberToSpanish(n){
  if(n === 0) return units[0];
  if(n < 1000) return under1000(n);

  const t = Math.floor(n/1000);
  const r = n % 1000;

  let left = (t === 1) ? "mil" : (units[t] + " mil");
  if(r === 0) return left;
  if(r < 100) return left + " " + under100(r);
  return left + " " + under1000(r);
}

/* UI */
function sayAnswer(){
  speak(numberToSpanish(current));
}

function startGame(){
  maxRange = Number(document.getElementById("level").value);
  correctTotal = 0;
  document.getElementById("correctCount").innerText = "0";
  document.getElementById("level").style.display = "none";
  document.getElementById("status").innerText = "";
  pickNew();
}

function showLevelSelect(){
  document.getElementById("level").style.display = "block";
  document.getElementById("status").innerText = "Elige un nivel";
}

/* Game flow */
function renderChoices(){
  const box = document.getElementById("choices");
  box.innerHTML = "";
  const correct = numberToSpanish(current);

  let options = [correct];
  while(options.length < 3){
    const rNum = Math.floor(Math.random() * (maxRange + 1));
    const rText = numberToSpanish(rNum);
    if(!options.includes(rText)) options.push(rText);
  }
  options.sort(()=>Math.random() - 0.5);

  options.forEach(text=>{
    const b = document.createElement("button");
    b.className = "choice";
    b.innerText = text;
    b.onclick = () => handleChoice(b, text);
    box.appendChild(b);
  });
}

function pickNew(){
  locked = false;
  current = Math.floor(Math.random() * (maxRange + 1));
  document.getElementById("num").innerText = current;
  document.getElementById("status").innerText = "";
  renderChoices();
}

async function handleChoice(btn, chosen){
  if(locked) return;

  const correct = numberToSpanish(current);

  if(chosen === correct){
    locked = true;
    btn.classList.add("good");

    correctTotal += 1;
    document.getElementById("correctCount").innerText = String(correctTotal);

    const msg = praise[Math.floor(Math.random() * praise.length)];
    document.getElementById("status").innerText = "‚úÖ " + msg;

    rightChime();

    speechSynthesis.cancel();
    await waitForSpeechEnd(correct);

    rightChime();
    await waitForSpeechEnd(msg);

    document.querySelectorAll("button.choice").forEach(b => b.disabled = true);
    setTimeout(pickNew, 300);
  } else {
    btn.classList.add("bad");
    document.getElementById("status").innerText = "‚ùå " + tryAgain;
    wrongBuzzer();
    speak(tryAgain);
  }
}

/* Start */
pickNew();
</script>

</body>
</html>